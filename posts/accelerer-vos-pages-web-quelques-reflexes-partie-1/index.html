<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AccÃ©lÃ©rer vos pages Web quelques rÃ©flexes âš¡ï¸ (Partie 1) | Alexandre CANTIN - Blog personnel</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.92.1" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="alexandre, cantin, blog, personnel">
<meta name="description" content="AccÃ©lÃ©rer vos pages Web : quelques rÃ©flexes âš¡ï¸ (partie 1) Cet article sera le premier dâ€™une sÃ©rie de trois :
 Images et polices personnalisÃ©es (cet â€¦">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/css/all.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/css/custom.css" />




<meta property="og:title" content="AccÃ©lÃ©rer vos pages Web quelques rÃ©flexes âš¡ï¸ (Partie 1)" />
<meta property="og:description" content="AccÃ©lÃ©rer vos pages Web : quelques rÃ©flexes âš¡ï¸ (partie 1) Cet article sera le premier dâ€™une sÃ©rie de trois :
 Images et polices personnalisÃ©es (cet article) JavaScript et prÃ©-chargement de ressources : https://link.medium.com/xxRg7Yc7j8 Contenus animÃ©s et LightHouse (Ã  venir)   Depuis sa naissance en 1989, le Web nâ€™a cessÃ© dâ€™offrir plus de possibilitÃ©s aux dÃ©veloppeurs afin de crÃ©er la meilleure expÃ©rience possible pour nos utilisateurs : images, vidÃ©os, interfaces dynamiques avec JavaScript, polices personnalisÃ©es etc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/accelerer-vos-pages-web-quelques-reflexes-partie-1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-07-07T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="AccÃ©lÃ©rer vos pages Web quelques rÃ©flexes âš¡ï¸ (Partie 1)"/>
<meta name="twitter:description" content="AccÃ©lÃ©rer vos pages Web : quelques rÃ©flexes âš¡ï¸ (partie 1) Cet article sera le premier dâ€™une sÃ©rie de trois :
 Images et polices personnalisÃ©es (cet article) JavaScript et prÃ©-chargement de ressources : https://link.medium.com/xxRg7Yc7j8 Contenus animÃ©s et LightHouse (Ã  venir)   Depuis sa naissance en 1989, le Web nâ€™a cessÃ© dâ€™offrir plus de possibilitÃ©s aux dÃ©veloppeurs afin de crÃ©er la meilleure expÃ©rience possible pour nos utilisateurs : images, vidÃ©os, interfaces dynamiques avec JavaScript, polices personnalisÃ©es etc."/>

<meta itemprop="name" content="AccÃ©lÃ©rer vos pages Web quelques rÃ©flexes âš¡ï¸ (Partie 1)">
<meta itemprop="description" content="AccÃ©lÃ©rer vos pages Web : quelques rÃ©flexes âš¡ï¸ (partie 1) Cet article sera le premier dâ€™une sÃ©rie de trois :
 Images et polices personnalisÃ©es (cet article) JavaScript et prÃ©-chargement de ressources : https://link.medium.com/xxRg7Yc7j8 Contenus animÃ©s et LightHouse (Ã  venir)   Depuis sa naissance en 1989, le Web nâ€™a cessÃ© dâ€™offrir plus de possibilitÃ©s aux dÃ©veloppeurs afin de crÃ©er la meilleure expÃ©rience possible pour nos utilisateurs : images, vidÃ©os, interfaces dynamiques avec JavaScript, polices personnalisÃ©es etc."><meta itemprop="datePublished" content="2020-07-07T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-07-07T00:00:00+00:00" />
<meta itemprop="wordCount" content="2255">
<meta itemprop="keywords" content="" />
</head>
<body>
<header>
<div id="titletext">
<h2 id="titleonly"><a href="">Alexandre CANTIN - Blog personnel</a></h2>
</div>
<div id="title-social">
<div id="social">
<nav><ul>
<li><a href="/https:/twitter.com/Cantin_Al"><i title="Twitter" class="icons fab fa-twitter"></i></a></li>
<li><a><i title="Switch Dark Mode" class="dark-mode icons fas fa-moon"></i></a></li>
</ul></nav>
</div>
</div>
</header>
<main>
<div class="post">
<article>
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">07</span>
<span class="rest">Jul 2020</span>
</div>
</div>
<div class="matter">
<h1 class="title">AccÃ©lÃ©rer vos pages Web quelques rÃ©flexes âš¡ï¸ (Partie 1)</h1>
<p class="post-meta">
<span class="post-meta">

&nbsp;<i class="fas fa-clock"></i>&nbsp;11&nbsp;minutes


 
&nbsp;| &nbsp;

<i class="fas fa-book"></i>&nbsp;2255&nbsp;words


</span>

</p>
</div>
</div>
<div class="markdown">
<h2 id="accÃ©lÃ©rer-vos-pages-web--quelques-rÃ©flexes--partie-1">AccÃ©lÃ©rer vos pages Web : quelques rÃ©flexes âš¡ï¸ (partie 1)</h2>
<p>Cet article sera le premier dâ€™une sÃ©rie de trois :</p>
<ul>
<li>Images et polices personnalisÃ©es (cet article)</li>
<li>JavaScript et prÃ©-chargement de ressources : <a href="https://link.medium.com/xxRg7Yc7j8" target="_blank">https://link.medium.com/xxRg7Yc7j8</a></li>
<li>Contenus animÃ©s et LightHouse (Ã  venir)</li>
</ul>
<hr>
<p>Depuis sa naissance en 1989, le Web nâ€™a cessÃ© dâ€™offrir plus de possibilitÃ©s aux dÃ©veloppeurs afin de crÃ©er la meilleure expÃ©rience possible pour nos utilisateurs : images, vidÃ©os, interfaces dynamiques avec JavaScript, polices personnalisÃ©es etc.</p>
<p>Toutefois, cela nâ€™est pas sans consÃ©quence : le poids de nos pages a augmentÃ© et il nâ€™est pas rare quâ€™une page Web dÃ©passe dÃ©sormais un voire plusieurs mÃ©gaoctets.</p>
<p>Dâ€™ailleurs, selon <a href="https://httparchive.org/" target="_blank">Httparchive.org</a>, en dix ans, malgrÃ© lâ€™augmentation constante des dÃ©bits Internet, la vitesse de chargement des pages est restÃ©eâ€¦ la mÃªme. De plus, Google considÃ¨re dÃ©sormais les performances comme un facteur influenÃ§ant son algorithme de <em>ranking</em>.</p>
<p>Dans cet article, nous prÃ©senterons ainsi diffÃ©rentes mÃ©thodes pour allÃ©ger vos pages. Cette liste sera non exhaustive et nous nous concentrerons sur les principaux leviers parmi la centaine (voire les milliers!) envisageables.</p>
<hr>
<p><strong>Note :</strong> les Ã©lÃ©ments prÃ©sentÃ©s ci-dessous visent les utilisateurs arrivant pour la <strong>premiÃ¨re fois</strong> sur votre site. Par consÃ©quent, les <em>services workers</em> ne seront pas abordÃ©s.</p>
<p>De mÃªme, je nâ€™aborderai pas des techniques que je considÃ¨re comme dÃ©jÃ  acquises comme la minification du CSS et du JavaScript</p>
<h2 id="-1---les-images">ğŸ 1 - Les images</h2>
<h3 id="11---rÃ©duction-du-poids--png-et-jpg">1.1 - RÃ©duction du poids : PNG et JPG</h3>
<p>OmniprÃ©sentes, les images sont les principaux responsables de lâ€™alourdissement du Web. Leur bonne gestion doit donc Ãªtre lâ€™une de vos prioritÃ©s et jâ€™oserai mÃªme dire un <strong>rÃ©flexe indispensable</strong> en tant que dÃ©veloppeur.</p>
<p>Pour ma part, je ne peux que vous conseillez dâ€™utiliser <a href="https://tinypng.com/" target="_blank">https://tinypng.com/</a> qui fonctionne via un simple <em>drag and drop</em>.
<figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_3y69fVWjZdHd5xNlf5nkng.jpeg" alt=""  />
</figure></p>
<p>Nous allons maintenant tester son efficacitÃ© avec lâ€™image de ce chat au format JPEG et pesant 357 Ko sans optimisation :</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_RsRyGVvxIfUif0r7-3ZAsA.jpeg" alt=""  />
</figure></p>
<p>Si nous lâ€™optimisons, TinyPng nous indique que le poids du fichier a Ã©tÃ© rÃ©duit de 49%, de 357 Ko Ã  181 Ko :</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_MR6PTW0ukkqglUY4o3I39Q.jpeg" alt=""  />
</figure></p>
<p>Un poids divisÃ© de moitiÃ© pour un rendu Ã©quivalent :</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_RsRyGVvxIfUif0r7-3ZAsA.jpeg" alt=""  />
</figure></p>
<p>Sachant que ce gain se rÃ©pÃ¨te pour chacune image de votre page, on comprend vite lâ€™intÃ©rÃªt crucial de bien optimiser lâ€™ensemble de ses images.</p>
<h2 id="12---quand-choisir-jpeg-et-png-">1.2 - Quand choisir JPEG et PNG ?</h2>
<p>Un autre point important est de choisir le bon format en fonction de vos besoins. En effet, ils rÃ©pondent tous les deux Ã  des exigences diffÃ©rentes et votre choix dÃ©pendra de plusieurs facteurs :</p>
<ul>
<li>la taille de lâ€™image : pour les â€œgrandesâ€ images (photos notamment), il faudra privilÃ©gier le format JPEG. Pour les â€œpetitesâ€ images (Ã©moticÃ´nes, icÃ´nesâ€¦), il faudra opter pour les PNG. Et si votre image est de taille â€œmoyenneâ€ ? Il faudra mener votre propre enquÃªte pour dÃ©terminer le meilleur choix (en fonction du poids mais aussi des autres critÃ¨res).</li>
<li>prÃ©cision du dessin : le format JPEG, Ã©tant un format compressÃ©, les contours perdent en nettetÃ© et cela nâ€™est pas forcÃ©ment souhaitable (graphiques, logo etc.). Il faudra opter pour le format PNG dans ce cas.</li>
<li>transparence : dans ce cas-lÃ , le PNG est la seule solution ğŸ™‚.</li>
</ul>
<h2 id="13---rÃ©duction-du-poids--svg">1.3 - RÃ©duction du poids : SVG</h2>
<p>Les images SVG peuvent aussi Ãªtre optimisÃ©es. Pour ma part, jâ€™utilise SVGOMG qui fonctionne lui aussi via drag and drop.</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_AAcgr2TlrIWwSnNj828dvw.jpeg" alt=""  />
</figure></p>
<p>Dans lâ€™exemple ci-dessus, on constate que le poids de notre SVG a rÃ©duit de 60%, passant de 1.5 Ko Ã  643 bytes et, mÃªme si le rÃ©sultat reste moins spectaculaire comparÃ© aux PNG et JPG, cela reste toutefois apprÃ©ciable ğŸ™‚.</p>
<h2 id="14---allez-plus-loin-avec-webp">1.4 - Allez plus loin avec Webp</h2>
<p>CrÃ©Ã© par Google en 2010, le Webp est un format dâ€™image qui se veut - en moyenne - 30% plus lÃ©ger comparÃ© au JPEG et 25% par rapport au PNG; tout en conservant gardant les effets de transparence pour ce dernier format.</p>
<p>Le Webp est donc un remplaÃ§ant de choix pour tous vos fichiers JPG et au niveau des PNG, Webp Ã©tant un format compressÃ©, cela dÃ©pendra principalement de la prÃ©cision du contour que vous souhaitez obtenir.</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_vCjNwPb1f6NpdzzH508EBw.jpeg" alt=""  />
</figure></p>
<p>Un des soucis majeur de ce format est son support dans les principaux navigateurs. En effet, bien que Chrome, Firefox et Edge (uniquement dans sa derniÃ¨re version) acceptent ce format, Safari le supportera dans sa prochaine version :</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_tCrFJTKdHbQj3-Y1WxsgeQ.png" alt=""  />
</figure></p>
<p>Cela ne doit pas pour autant vous dÃ©courager dâ€™utiliser le format Webp et nous verrons plus tard comme gÃ©rer les navigateurs non compatibles.</p>
<p>Pour convertir vos images en Webp, je peux vous conseiller dâ€™utiliser <a href="https://www.xnview.com/fr/xnconvert/" target="_blank">XnConvert</a> qui fonctionne directement sur votre ordinateur (disponible pour Windows/Linux/MacOs). Comme solutions en ligne, <a href="https://ezgif.com/png-to-webp" target="_blank">https://ezgif.com/png-to-webp</a> et <a href="https://ezgif.com/jpg-to-webp" target="_blank">https://ezgif.com/jpg-to-webp</a> fonctionnent trÃ¨s bien ğŸ™‚.</p>
<p>La conversion se rÃ©alise en 3 Ã©tapes (nous partirons de lâ€™image du chat optimisÃ©e prÃ©cÃ©demment) :</p>
<ol>
<li>
<p>Ajouter les images :
<figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_Y--_PRA546tRfXDMXaNFbQ.png" alt=""  />
</figure></p>
</li>
<li>
<p>Cliquer sur lâ€™onglet â€œSortieâ€ puis :</p>
</li>
</ol>
<ul>
<li>Indiquer â€œ{Filename}.pngâ€ ou â€œ{Filename}.jpegâ€ dans le champ â€œNom du fichierâ€. Le choix de ce formatage sera important pour la suite ğŸ˜‰</li>
<li>Choisir â€œWEBP-Webpâ€ dans le bloc format</li>
<li>DÃ©cocher la case â€œPrÃ©server les mÃ©tadonnÃ©esâ€ et cocher â€œPrÃ©server lâ€™extensionâ€
<figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_HKM07xjIBoN2RvMUYSoeKg.png" alt=""  />
</figure></li>
</ul>
<ol start="3">
<li>Pour finir, cliquer sur â€œConvertirâ€ en bas Ã  droite de la fenÃªtre :
<figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_lALHwh7J3k5_B6lIHkiLnw.png" alt=""  />
</figure></li>
</ol>
<p>Nous obtenons ainsi une image avec le nom : [nom-image].jpeg.webp (ou [nom-image].png.webp). Dans notre exemple, le poids est passÃ© de 181 Ko Ã  149 Ko.</p>
<h2 id="141---cohabitation-entre-webp-et-pngjpeg-avec-_figure_">1.4.1 - Cohabitation entre Webp et PNG/JPEG avec <em>&lt;figure&gt;</em></h2>
<p>Introduite en 2015, la balise &lt;picture&gt; permet de spÃ©cifier plusieurs rÃ¨gles afin que le navigateur puisse dÃ©terminer l&rsquo;image la plus pertinente Ã  tÃ©lÃ©charger. Plusieurs conditions sont possibles : densitÃ© de pixels, dimensions du navigateur&hellip; et le format d&rsquo;image ğŸ™‚.</p>
<p>Pour utiliser &lt;picture&gt;, il suffit de lui associer plusieurs &lt;source&gt; :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">picture</span>&gt;
  &lt;<span style="color:#f92672">source</span> <span style="color:#a6e22e">srcset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;chat-mignon.webp&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;image/webp&#34;</span> /&gt;
  &lt;<span style="color:#f92672">source</span> <span style="color:#a6e22e">srcset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;chat-mignon.jpeg&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;image/jpeg&#34;</span> /&gt;
  &lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;chat-mignon.jpeg&#34;</span> <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> /&gt;
&lt;/<span style="color:#f92672">picture</span>&gt;
</code></pre></div><p>Dans cet exemple, le navigateur optera pour le format Webp sâ€™il le gÃ¨re et JPEG dans le cas contraire. Lâ€™usage de &lt;picture&gt; est donc d&rsquo;une grande simplicitÃ© ğŸ™‚.</p>
<p>Malheureusement, il nous reste le cas dâ€™une image importÃ©e via CSS et malheureusement, il nâ€™existe pas dâ€™Ã©quivalents Ã  &lt;picture&gt; pour le CSS.</p>
<p>La solution est alors dâ€™utiliser JavaScript pour dÃ©terminer ce support et notamment via ce snippet (proposÃ© par Jake Archibald) :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">supportsWebp</span>() {
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">createImageBitmap</span>) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;

  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">webpData</span> <span style="color:#f92672">=</span>
    <span style="color:#e6db74">&#34;data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=&#34;</span>;
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">webpData</span>).<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">r</span>) =&gt; <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">blob</span>());
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">createImageBitmap</span>(<span style="color:#a6e22e">blob</span>).<span style="color:#a6e22e">then</span>(
    () =&gt; <span style="color:#66d9ef">true</span>,
    () =&gt; <span style="color:#66d9ef">false</span>
  );
}
</code></pre></div><p>En fonction de la rÃ©ponse, vous pourrez ajouter une classe webp ou no-webp Ã  la balise &lt;body&gt; pour, ensuite, au niveau du CSS, utiliser cette classe pour appeler la bonne image :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">.<span style="color:#a6e22e">no-webp</span> .<span style="color:#a6e22e">cat-background</span> {
  <span style="color:#66d9ef">background-image</span>: url(<span style="color:#e6db74">&#34;chat-mignon.jpg&#34;</span>);
}

.<span style="color:#a6e22e">webp</span> .<span style="color:#a6e22e">cat-background</span> {
  <span style="color:#66d9ef">background-image</span>: url(<span style="color:#e6db74">&#34;chat-mignon.webp&#34;</span>);
}
</code></pre></div><h2 id="142---cohabitation-entre-webp-et-pngjpeg-avec-nginx">1.4.2 - Cohabitation entre Webp et PNG/JPEG avec nginx</h2>
<p>Si vous ne souhaitez pas convertir lâ€™ensemble de vos balises &lt;img /&gt; de votre projet ou d&rsquo;utiliser une classe Ã  la balise &lt;body&gt;, il est possible de dÃ©livrer le bon format d&rsquo;image en fonction du support du navigateur et cela grÃ¢ce Ã  Nginx.</p>
<p>Pour obtenir ce comportement, la premier prÃ©requis sera de faire cohabiter lâ€™image JPEG/PNG Ã  cÃ´tÃ© de son Ã©quivalent Webp. Nous obtenons ainsi :
images/</p>
<pre tabindex="0"><code>- chat.jpeg
- chat.jpeg.webp
</code></pre><p>Dans un second temps, nous utiliserons lâ€™instruction <code>map</code> de Nginx pour crÃ©er une variable $webp_suffix.
Cette derniÃ¨re contiendra .webp ou sera vide en fonction du support de Webp par le navigateur. Ce support sera dÃ©terminÃ© suivant le contenu du header HTTP Accept de la requÃªte :</p>
<pre tabindex="0"><code># Detect if browser accepts .webp images ?

    map $http_accept $webp_suffix {
      default&quot;&quot;;
      &quot;~*webp&quot; &quot;.webp&quot;;
    }
</code></pre><p>Pour finir, nous utiliserons la commande <code>try_files</code> de Nginx, permettant de tester la prÃ©sence de plusieurs fichiers successivement et renvoyer le premier trouvÃ©.</p>
<pre tabindex="0"><code># Handle .webp

    location ~* ^/assets/.+\.(jpe?g|png)$ {
        root /home/deploy/build/;
        try_files $uri$webp_suffix $uri =404;
    }
</code></pre><p>Ainsi, nous testerons dans lâ€™ordre :</p>
<p>1 â€” lâ€™URL de la ressource concatÃ©nÃ©e avec la valeur <code>$webp_suffix</code> pouvant donc Ãªtre <code>&lt;nom-image&gt;.jpeg.webp</code> ou <code>&lt;nom-image&gt;.jpeg</code>
2 - l&rsquo;URL demandÃ©e en solution de secours (en cas d&rsquo;absence du fichier Webp notamment)
3 - Erreur 404</p>
<p>Nous obtenons un systÃ¨me faisant cohabiter Ã  la fois les images au format JPEG/PNG et Webp, basÃ©e sur la prise en charge du format par le navigateur de lâ€™utilisateur.
Dâ€™ailleurs, on constate sur la console de Google Chrome que le fichier reÃ§u est bien une image Webp :</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_LFxHOGV5-OPu80NTBwWYdA.png" alt=""  />
</figure></p>
<h2 id="15---lazy-loading">1.5 - Lazy-loading</h2>
<p>Les images les plus lÃ©gÃ¨res restent celles quâ€™on ne tÃ©lÃ©charge pas. Pour cela, le <em>lazy-loading</em> est la solution toute nommÃ©e et consiste Ã  tÃ©lÃ©charger une ressource seulement si cela sâ€™avÃ¨re nÃ©cessaire. Dans le cas dâ€™une image, lâ€™Ã©lÃ©ment dÃ©clenchant son tÃ©lÃ©chargement sera ainsi son apparition â€” ou sa proche apparition â€” dans la zone dâ€™affichage de la page Web.</p>
<h3 id="151---avec-lazysizes">1.5.1 - Avec Lazysizes</h3>
<p><a href="https://github.com/aFarkas/lazysizes" target="_blank">Lazysizes</a> est une librairie JavaScript nous facilitant la mise en place du lazy loading dâ€™images. Dâ€™une taille compressÃ©e de 3.2Ko, son utilisation se veut assez simple en renommant notre attribut <code>src</code> en <code>data-src</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">data-src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;static/logo.jpg&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lazyload&#34;</span> <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> /&gt;
</code></pre></div><p>De plus, Lazysize nous permet aussi dâ€™adapter les images en fonction de lâ€™appareil de lâ€™utilisateur (mobile, tablette ou PC).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">img</span>
  <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
  <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lazyload&#34;</span>
  <span style="color:#a6e22e">data-srcset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;small.jpg 500w, medium.jpg 640w, big.jpg 1024w&#34;</span>
  <span style="color:#a6e22e">data-src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;medium.jpg&#34;</span>
/&gt;
</code></pre></div><p>Simple mais terriblement efficace ğŸ™‚.</p>
<h3 id="152---avec-lattribut-_loading_-de-_img_">1.5.2 - Avec lâ€™attribut <em>loading</em> de <em>img</em></h3>
<p>La balise img accueille depuis peu un nouvel attribut loading qui, couplÃ© avec la valeur lazy, permet d&rsquo;implÃ©menter nativement un systÃ¨me de lazy loading :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;chat-mignon.png&#34;</span> <span style="color:#a6e22e">loading</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lazy&#34;</span> <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> /&gt;
</code></pre></div><p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_k6HB-gq_2rebeOca5utXfQ.png" alt=""  />
</figure></p>
<p>Sa prise en compte est donc loin dâ€™Ãªtre garantieâ€¦ Toutefois, vous ne perdez rien Ã  implÃ©menter ce nouvel attribut qui sera tout simplement ignorÃ© par les navigateurs non compatibles ğŸ™‚ (qui tÃ©lÃ©chargeront donc directement lâ€™image).</p>
<hr>
<h2 id="-2---les-polices-personnalisÃ©es">ğŸš¨ 2 - Les polices personnalisÃ©es</h2>
<p>Relativement rÃ©cent dans lâ€™histoire du Web, lâ€™ajout des polices personnalisÃ©es apporte une touche de personnalisation supplÃ©mentaire au design de nos pages. Et mÃªme sâ€™elles sont minimes, des optimisations restent possibles.</p>
<h3 id="21---fonctionnement-des-polices-personnalisÃ©es">2.1 - Fonctionnement des polices personnalisÃ©es</h3>
<p>Avant de nous attarder sur les amÃ©liorations de performances possibles, il est nÃ©cessaire de prÃ©senter le fonctionnement des polices personnalisÃ©es.</p>
<p>Tout dâ€™abord, lâ€™inclusion dâ€™une police peut se rÃ©aliser de plusieurs maniÃ¨res mais les deux mÃ©thodes les plus courantes sont :</p>
<ul>
<li>1- Lâ€™import direct de la police depuis notre serveur</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">@<span style="color:#66d9ef">font-face</span> {
  <span style="color:#f92672">font-family</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Open Sans&#34;</span><span style="color:#f92672">;</span>
  <span style="color:#f92672">src</span><span style="color:#f92672">:</span> <span style="color:#f92672">url</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/fonts/OpenSans-Regular-webfont.woff2&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;woff2&#34;</span><span style="color:#f92672">),</span> <span style="color:#f92672">url</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/fonts/OpenSans-Regular-webfont.woff&#34;</span><span style="color:#f92672">)</span>
      <span style="color:#f92672">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;woff&#34;</span><span style="color:#f92672">);</span>
}
</code></pre></div><ul>
<li>2- Via une ressource externe (ici, Google Fonts) :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">link</span>
  <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&#34;</span>
  <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span>
/&gt;
</code></pre></div><p>Dans tous les cas, lâ€™utilisation dans nos styles CSS est identique :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="color:#f92672">body</span> {
  <span style="color:#66d9ef">font-family</span>: <span style="color:#e6db74">&#34;Open Sans&#34;</span>, <span style="color:#66d9ef">serif</span>;
}
</code></pre></div><p>Bien entendu, la police nâ€™est pas directement prÃ©sente sur le navigateur et doit donc Ãªtre tÃ©lÃ©chargÃ©e. Mais que se passe-t-il pendant ce temps au niveau de lâ€™affichage ? Figurez-vous que le navigateur nâ€™affiche tout simplementâ€¦rien ! Plus exactement, il compense lâ€™absence de la police en la remplaÃ§ant par une police invisible dont la taille se veut proche du rÃ©sultat final (via font-size et font-weight principalement).</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-1/1_hXMneAoYUkwm-vZ_Ym0CTA.png" alt=""  />
</figure></p>
<p>Par dÃ©faut, cette situation va durer 3 secondes (sur Firefox et Chrome tout du moins) avant que le navigateur bascule sur la seconde police (serif dans notre exemple). Trois secondes pendant lesquelles lâ€™utilisateur ne pourra lire le contenu de votre siteâ€¦</p>
<p>Bien sÃ»r, dÃ¨s que la police sera tÃ©lÃ©chargÃ©e, lâ€™affichage de votre page sera mis Ã  jour (que ce soit avant ou aprÃ¨s les 3 secondes de dÃ©lai).</p>
<h2 id="22---utilisation-de-display-swap">2.2 - Utilisation de display: swap</h2>
<p>La rÃ¨gle CSS <code>font-display</code> permet de modifier la politique d&rsquo;import des polices personnalisÃ©es, sa valeur par dÃ©faut est auto et correspond au scÃ©nario dÃ©crit prÃ©cÃ©demment.</p>
<p>En remplaÃ§ant <code>auto</code> par <code>swap</code>, le dÃ©lai de basculement vers la police de remplacement passe alors de 3 secondes Ã  100 ms ! Un gain de temps apprÃ©ciable et rÃ©duisant ainsi le Time to first meaningful paint, mÃ©trique dÃ©finie par Google correspondant au temps d&rsquo;apparition du premier contenu pertinent.</p>
<p>Son utilisation est extrÃªmement simple.</p>
<p>Dans notre premier cas dâ€™import, nous ajoutons simplement <code>font-display</code>: swap; dans le bloc <code>@font-face</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">@<span style="color:#66d9ef">font-face</span> {
  <span style="color:#f92672">font-family</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Open Sans&#34;</span><span style="color:#f92672">;</span>
  <span style="color:#f92672">src</span><span style="color:#f92672">:</span> <span style="color:#f92672">url</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/fonts/OpenSans-Regular-webfont.woff2&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;woff2&#34;</span><span style="color:#f92672">),</span> <span style="color:#f92672">url</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/fonts/OpenSans-Regular-webfont.woff&#34;</span><span style="color:#f92672">)</span>
      <span style="color:#f92672">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;woff&#34;</span><span style="color:#f92672">);</span>
  <span style="color:#f92672">font-display</span><span style="color:#f92672">:</span> <span style="color:#f92672">swap</span><span style="color:#f92672">;</span>
}
</code></pre></div><p>Pour Google Fonts, depuis mai 2019, il suffit dâ€™ajouter â€˜&amp;display=swapâ€™ dans lâ€™URL dâ€™import pour obtenir, par exemple :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">link</span>
  <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&amp;display=swap&#34;</span>
  <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span>
/&gt;
</code></pre></div><p>Si vous souhaitez gÃ©rer plus finement votre police dâ€™import de polices, font-display autorise d&rsquo;autres valeurs :</p>
<ul>
<li>
<p><strong>font-display: block</strong> -&gt;
Cette option est semblable au fonctionnement par dÃ©faut : 3 secondes de police invisible avant de basculer sur la police de remplacement. Son seul intÃ©rÃªt est de sâ€™assurer que nous ayons bien ces 3 secondes de dÃ©lai, Ã©tant donnÃ© que tous les navigateurs peuvent avoir une politique auto diffÃ©rente comparÃ©e Ã  celle de Firefox et Chrome.</p>
</li>
<li>
<p><strong>font-display: fallback</strong> -&gt;</p>
<p>Lâ€™option <code>fallback</code> rÃ©duit aussi le dÃ©lai de basculement vers la police de remplacement Ã  100 ms mais limite aussi la durÃ©e de rÃ©cupÃ©ration de la police personnalisÃ©e Ã  3 secondes (lÃ  oÃ¹ <code>swap</code> n&rsquo;impose pas de durÃ©e de temps). Elle permet donc d&rsquo;indiquer au navigateur d&rsquo;arrÃªter la rÃ©cupÃ©ration de la police si son tÃ©lÃ©chargement s&rsquo;avÃ¨re trop long.</p>
</li>
<li>
<p><strong>font-display: optional</strong> -&gt;
Plus radicale que <code>fallback</code>, elle rÃ©duit le dÃ©lai de basculement Ã  100 ms mais arrÃªte la rÃ©cupÃ©ration de la police par la mÃªme occasion. Traduction pour le navigateur: &ldquo;Si tu as la police sous la main (donc en cache) tu l&rsquo;utilises, sinon inutile de la rÃ©cupÃ©rer&rdquo;.</p>
</li>
</ul>
<h2 id="fin-de-la-premiÃ¨re-partie">Fin de la premiÃ¨re partie</h2>
<p>Nous voici arrivÃ©s Ã  la fin de cette premiÃ¨re partie consacrÃ©e aux images et aux polices personnalisÃ©es.</p>
<p>Dans le prochain Ã©pisode, nous aborderons les optimisations liÃ©es JavaScript et le prÃ©-chargement de ressources.</p>
<p>Restez connectÃ© ğŸ™‚.</p>
<h2 id="-aller-plus-loin">ğŸ”° Aller plus loin</h2>
<h3 id="vidÃ©os-et-articles">VidÃ©os et articles</h3>
<p>Voici un ensemble de ressources pour explorer lâ€™univers de lâ€™optimisation des chargements :</p>
<ul>
<li>Fast load times : <a href="https://web.dev/fast/" target="_blank">https://web.dev/fast/</a></li>
<li>Lazy-loading dâ€™images et iframe : <a href="https://web.dev/native-lazy-loading/" target="_blank">https://web.dev/native-lazy-loading/</a></li>
<li>Web performance made easy (Google I/O â€™18) :
<a href="https://www.youtube.com/watch?v=Mv-l3-tJgGk" target="_blank">https://www.youtube.com/watch?v=Mv-l3-tJgGk</a></li>
<li>Speed at Scale: Web Performance Tips and Tricks from the Trenches (Google I/O â€™19) : <a href="https://www.youtube.com/watch?v=YJGCZCaIZkQ" target="_blank">https://www.youtube.com/watch?v=YJGCZCaIZkQ</a></li>
<li>Polices personnalisÃ©es :
<a href="https://developers.google.com/web/updates/2016/02/font-display" target="_blank">https://developers.google.com/web/updates/2016/02/font-display</a></li>
</ul>
<h3 id="sur-twitter">Sur Twitter</h3>
<ul>
<li>Houssein Djirdeh : <a href="https://twitter.com/hdjirdeh" target="_blank">https://twitter.com/hdjirdeh</a></li>
<li>Addy Osmani : <a href="https://twitter.com/addyosmani" target="_blank">https://twitter.com/addyosmani</a></li>
<li>Katie Hempenius : <a href="https://twitter.com/katiehempenius" target="_blank">https://twitter.com/katiehempenius</a></li>
<li>Paul Irish : <a href="https://twitter.com/paul_irish" target="_blank">https://twitter.com/paul_irish</a></li>
<li>Lighthouse : <a href="https://twitter.com/____lighthouse" target="_blank">https://twitter.com/____lighthouse</a></li>
</ul>

</div>
</div>
</article>
</div>
</main><script src="/js/dark-mode.js"></script>

</body>
</html>
