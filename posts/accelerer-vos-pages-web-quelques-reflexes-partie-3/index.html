<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Acc√©l√©rer vos pages Web quelques r√©flexes ‚ö°Ô∏è (Partie 3) | Alexandre CANTIN - Blog personnel</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.92.1" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="alexandre, cantin, blog, personnel">
<meta name="description" content="Cet article sera le troisi√®me et dernier d‚Äôune s√©rie de trois :
 Images et polices personnalis√©es: https://link.medium.com/Hxw5ex6Zj8 JavaScript et ‚Ä¶">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/css/all.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/css/custom.css" />




<meta property="og:title" content="Acc√©l√©rer vos pages Web quelques r√©flexes ‚ö°Ô∏è (Partie 3)" />
<meta property="og:description" content="Cet article sera le troisi√®me et dernier d‚Äôune s√©rie de trois :
 Images et polices personnalis√©es: https://link.medium.com/Hxw5ex6Zj8 JavaScript et pr√©-chargement de ressources : https://link.medium.com/5UQk6msPF8 Contenus anim√©s et LightHouse (cet article)   üé¨ 5 - Contenus anim√©es : .mp4 et GIF 5.1 - Privil√©gier les vid√©os .mp4 sur les GIF Cette recommandation peut sembler contre-intuitive mais, dans le cas des GIFs, il est n√©cessaire de les convertir en .mp4 pour diminuer leur poids." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://alexandrecantin.github.io/posts/accelerer-vos-pages-web-quelques-reflexes-partie-3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-04T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Acc√©l√©rer vos pages Web quelques r√©flexes ‚ö°Ô∏è (Partie 3)"/>
<meta name="twitter:description" content="Cet article sera le troisi√®me et dernier d‚Äôune s√©rie de trois :
 Images et polices personnalis√©es: https://link.medium.com/Hxw5ex6Zj8 JavaScript et pr√©-chargement de ressources : https://link.medium.com/5UQk6msPF8 Contenus anim√©s et LightHouse (cet article)   üé¨ 5 - Contenus anim√©es : .mp4 et GIF 5.1 - Privil√©gier les vid√©os .mp4 sur les GIF Cette recommandation peut sembler contre-intuitive mais, dans le cas des GIFs, il est n√©cessaire de les convertir en .mp4 pour diminuer leur poids."/>

<meta itemprop="name" content="Acc√©l√©rer vos pages Web quelques r√©flexes ‚ö°Ô∏è (Partie 3)">
<meta itemprop="description" content="Cet article sera le troisi√®me et dernier d‚Äôune s√©rie de trois :
 Images et polices personnalis√©es: https://link.medium.com/Hxw5ex6Zj8 JavaScript et pr√©-chargement de ressources : https://link.medium.com/5UQk6msPF8 Contenus anim√©s et LightHouse (cet article)   üé¨ 5 - Contenus anim√©es : .mp4 et GIF 5.1 - Privil√©gier les vid√©os .mp4 sur les GIF Cette recommandation peut sembler contre-intuitive mais, dans le cas des GIFs, il est n√©cessaire de les convertir en .mp4 pour diminuer leur poids."><meta itemprop="datePublished" content="2020-08-04T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-08-04T00:00:00+00:00" />
<meta itemprop="wordCount" content="1441">
<meta itemprop="keywords" content="" />
</head>
<body>
<header>
<div id="titletext">
<h2 id="titleonly"><a href="https://alexandrecantin.github.io/">Alexandre CANTIN - Blog personnel</a></h2>
</div>
<div id="title-social">
<div id="social">
<nav><ul>
<li><a href="https://twitter.com/Cantin_Al"><i title="Twitter" class="icons fab fa-twitter"></i></a></li>
<li><a><i title="Switch Dark Mode" class="dark-mode icons fas fa-moon"></i></a></li>
</ul></nav>
</div>
</div>
</header>
<main>
<div class="post">
<article>
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">04</span>
<span class="rest">ao√ªt 2020</span>
</div>
</div>
<div class="matter">
<h1 class="title">Acc√©l√©rer vos pages Web quelques r√©flexes ‚ö°Ô∏è (Partie 3)</h1>
<p class="post-meta">
<span class="post-meta">

&nbsp;<i class="fas fa-clock"></i>&nbsp;7&nbsp;


 
&nbsp;| &nbsp;

<i class="fas fa-book"></i>&nbsp;1441&nbsp;


</span>

</p>
</div>
</div>
<div class="markdown">
<p>Cet article sera le troisi√®me et dernier d‚Äôune s√©rie de trois :</p>
<ol>
<li>Images et polices personnalis√©es: <a href="https://link.medium.com/Hxw5ex6Zj8" target="_blank">https://link.medium.com/Hxw5ex6Zj8</a></li>
<li>JavaScript et pr√©-chargement de ressources : <a href="https://link.medium.com/5UQk6msPF8" target="_blank">https://link.medium.com/5UQk6msPF8</a></li>
<li>Contenus anim√©s et LightHouse (cet article)</li>
</ol>
<hr>
<h2 id="-5---contenus-anim√©es--mp4-et-gif">üé¨ 5 - Contenus anim√©es : .mp4 et GIF</h2>
<h3 id="51---privil√©gier-les-vid√©os-mp4-sur-les-gif">5.1 - Privil√©gier les vid√©os .mp4 sur les GIF</h3>
<p>Cette recommandation peut sembler contre-intuitive mais, dans le cas des GIFs, il est n√©cessaire de les convertir en .mp4 pour diminuer leur poids.</p>
<p>En effet, bien que le format GIF soit un format d‚Äôimage, il s‚Äôagit d‚Äôune succession d‚Äôimages et peut donc √™tre assimil√© √† une vid√©o. Toutefois, contrairement au format .mp4, le format GIF est moins bien optimis√©.</p>
<p>Prenons par exemple, le GIF ci-dessous dont le poids est de 5.1 Mo :</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-3/0_f8uexR7rNWS_IATn.gif" alt=""  />
</figure></p>
<p>Pour ensuite obtenir un rendu et comportement similaires √† ceux d‚Äôune image GIF, il est n√©cessaire d‚Äôajouter les attributs <code>autoplay loop muted playsinline</code> √† la balise <code>video</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">video</span> <span style="color:#a6e22e">autoplay</span> <span style="color:#a6e22e">loop</span> <span style="color:#a6e22e">muted</span> <span style="color:#a6e22e">playsinline</span>&gt;
  &lt;<span style="color:#f92672">source</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;video.mp4&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;video/mp4&#34;</span> /&gt;
&lt;/<span style="color:#f92672">video</span>&gt;
</code></pre></div><p>Si vous souhaitez aller plus loin, il est aussi possible d‚Äôadapter le rendu en fonction de la qualit√© de la connexion Internet de l‚Äôutilisateur avec <code>navigator.connection.effectiveType</code> pour, par exemple, renvoyer une image (optimis√©e bien entendu) √† la place d&rsquo;une vid√©o :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">navigator</span>.<span style="color:#a6e22e">connection</span>.<span style="color:#a6e22e">effectiveType</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;4g&#34;</span>)
  <span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Video</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;animate-background.mp4&#34;</span> <span style="color:#f92672">/&gt;</span>;
<span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;background.png&#34;</span> <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">/&gt;</span>;
</code></pre></div><p>Malheureusement, cette fonctionnalit√© est pour le moment tr√®s mal support√©e par les diff√©rents navigateurs :</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-3/0_gVZ7Vu2C_aP2ydIb.png" alt=""  />
</figure></p>
<h3 id="52--attention-au-player-youtube">5.2 ‚Äî Attention au player Youtube</h3>
<p>Youtube fournit un moyen simple d‚Äôh√©berger mais aussi d‚Äôint√©grer des vid√©os dans vos pages via une <em>iframe</em>. Toutefois, cette derni√®re va t√©l√©charger tous un ensemble de fichiers pour un total de 584 Ko !</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-3/0_f905GrPpwM329nZ-.png" alt=""  />
</figure></p>
<p>Bien s√ªr, √† ce temps de t√©l√©chargement s‚Äôadditionne le temps de parsing, compilation et d‚Äôex√©cution du navigateur. Qui plus est, l‚Äôutilisateur paiera ce prix qu‚Äôil <strong>visionne ou non</strong> cette vid√©o !
Comment √©viter cela ? Deux solutions sont envisageables.</p>
<h4 id="521---le-lazy-loading">5.2.1 - Le lazy loading</h4>
<p>La premi√®re solution renvoie au chapitre relatif au lazy loading des images : l‚Äôiframe la plus optimale reste celle qu‚Äôon ne t√©l√©charge pas. De m√™me, les deux solutions √©voqu√©es sont aussi d‚Äôactualit√©s, √† savoir :</p>
<ol>
<li>Utiliser <em>lazysizes</em> en rempla√ßant l‚Äôattribut <code>src</code> par <code>data-src</code>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">iframe</span>
  <span style="color:#a6e22e">frameborder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>
  <span style="color:#a6e22e">allowfullscreen</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
  <span style="color:#a6e22e">data-src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;//www.youtube.com/embed/ZfV-aYdU4uE&#34;</span>
&gt;
&lt;/<span style="color:#f92672">iframe</span>&gt;
</code></pre></div><ol start="2">
<li>Utiliser l‚Äôattribut <code>loading=&quot;lazy&quot;</code> (dont le support - ou son manque de support - reste identique aux images) :</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">iframe</span>
  <span style="color:#a6e22e">frameborder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>
  <span style="color:#a6e22e">allowfullscreen</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
  <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;//www.youtube.com/embed/ZfV-aYdU4uE&#34;</span>
  <span style="color:#a6e22e">loading</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lazy&#34;</span>
&gt;&lt;/<span style="color:#f92672">iframe</span>&gt;
</code></pre></div><p>Toutefois, le probl√®me n‚Äôest r√©solu qu‚Äô√† moiti√© : d√®s que la vid√©o appara√Æt √† l‚Äô√©cran de l‚Äôutilisateur, nous r√©cup√©rons l‚Äôensemble des 584 Ko de JavaScript.</p>
<h4 id="522---un-faux-lecteur-vid√©o">5.2.2 - Un faux lecteur vid√©o</h4>
<p>L‚Äôid√©e, au premier abord, peut sembler saugrenue mais permet d‚Äôobtenir le r√©sultat escompt√© : remplacer le <em>player</em> Youtube par un bouton contenant une image de pr√©-visualisation associ√©e √† une ic√¥ne de lecture. En cas de clic, nous basculons ensuite sur l‚Äôiframe de Youtube en lecture automatique (via <code>autoplay=1</code>).</p>
<p>Note : pour r√©aliser ce composant, nous utiliserons React mais une transposition vers des √©quivalents Svelte, Vue ou Angular est facilement envisageable.</p>
<p>Ce composant accueillera deux param√®tres que seront :</p>
<ul>
<li>l‚Äôidentifiant de la vid√©o Youtube</li>
<li>le titre de vid√©o (pour l‚Äôaccessibilit√© ‚Äî notamment ceux avec un lecteur d‚Äô√©cran)</li>
</ul>
<p>Pour utiliser ce composant, nous proc√©derons de la sorte :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">YoutubeVideo</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dQw4w9WgXcQ&#34;</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Never gonna give you up&#34;</span> /&gt;
</code></pre></div><p>Tout d‚Äôabord, nous commencerons par cr√©er le bouton en question :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">React</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;react&#34;</span>;
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">YoutubeVideo</span>({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">title</span> }) {
  <span style="color:#66d9ef">return</span> (
    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span>
      <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>
      <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`Vid√©o Youtube : </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">title</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>}
      <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">buttonStyle</span>}
      <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">startVideo</span>}
    <span style="color:#f92672">&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">img</span>
        <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">imgStyle</span>}
        <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`https://img.youtube.com/vi/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/hqdefault.jpg`</span>}
        <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
      <span style="color:#f92672">/&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">img</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">youtubeIconStyle</span>} <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;youtube-icon.svg&#34;</span> <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
  );
}
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">YoutubeVideo</span>;
</code></pre></div><p>En ajoutant un peu de style √† notre bouton, nous allons :</p>
<ul>
<li>
<p>indiquer les dimensions de la vid√©o, dimensions qui seront identiques pour la vid√©o et le bouton</p>
</li>
<li>
<p>centrer l‚Äôic√¥ne de lecture verticalement et horizontalement</p>
</li>
<li>
<p>ajuster l‚Äôimage de pr√©-visualisation pour qu‚Äôelle occupe la totalit√© de l‚Äôespace disponible. D‚Äôailleurs, concernant cette image, vous pouvez remarquer qu‚Äôelle provient directement de Youtube; l‚Äôimage d‚Äôune vid√©o pouvant √™tre r√©cup√©r√©e √† l‚Äôadresse suivante : <code>https://img.youtube.com/vi/[IDENTIFIANT_VIDEO]/hqdefault.jpg</code>.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">/* Dimensions de la vid√©o et du bouton */</span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;100%&#34;</span>,
  <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;350px&#34;</span>,
};
<span style="color:#75715e">/* Centrer l&#39;ic√¥ne Youtube (entre autres...) */</span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">buttonStyle</span> <span style="color:#f92672">=</span> {
  ...<span style="color:#a6e22e">style</span>,
  <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;relative&#34;</span>,
  <span style="color:#a6e22e">overflow</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;hidden&#34;</span>,
  <span style="color:#a6e22e">cursor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;pointer&#34;</span>,
  <span style="color:#a6e22e">display</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;flex&#34;</span>,
  <span style="color:#a6e22e">justifyContent</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;center&#34;</span>,
  <span style="color:#a6e22e">alignItems</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;center&#34;</span>,
  <span style="color:#a6e22e">border</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;none&#34;</span>,
};
<span style="color:#75715e">/* Image de pr√©-visualisation pour occuper tout l&#39;espace */</span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imgStyle</span> <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;100%&#34;</span>,
  <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;100%&#34;</span>,
  <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;absolute&#34;</span>,
  <span style="color:#a6e22e">zIndex</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
};
<span style="color:#75715e">/* Placer l&#39;ic√¥ne au-dessus de celle de pr√©-visualisation */</span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">youtubeIconStyle</span> <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">zIndex</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>,
};
</code></pre></div><p>Pour le moment, nous obtenons un bouton qui ne fait simplement rien‚Ä¶ mais qui ressemble fortement √† la preview d‚Äôune vid√©o Youtube :</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-3/0_TpnkNgRvDIuvENbY.png" alt=""  />
</figure></p>
<p>La suite consistera √† ajouter une variable au sein de notre composant, nomm√©e <code>showVideo</code>, g√©rant l&rsquo;affichage de l'<em>iframe</em>. Elle sera √† <code>false</code> par d√©faut et signifiera que l&rsquo;on affichera le bouton de pr√©-visualisation. Au clic sur le bouton, <code>showVideo</code> deviendra <code>true</code> et occasionnera le d√©marrage de la vid√©o.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">YoutubeVideo</span>({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">imgSrc</span>, <span style="color:#a6e22e">title</span> }) {
  <span style="color:#75715e">// On utilise les hooks React
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">showVideo</span>, <span style="color:#a6e22e">setShowVideo</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#66d9ef">false</span>);
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">startVideo</span>() {
    <span style="color:#a6e22e">setShowVideo</span>(<span style="color:#66d9ef">true</span>);
  }
  ...
  <span style="color:#66d9ef">return</span> (
    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span>
      <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">startVideo</span>} <span style="color:#75715e">// &lt;=== Action au clic
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>
      <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`Vid√©o Youtube : </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">title</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>}
      <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">buttonStyle</span>}
    <span style="color:#f92672">&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">img</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">imgStyle</span>} <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`https://img.youtube.com/vi/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/hqdefault.jpg`</span>} <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">/&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">img</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">youtubeIconStyle</span>} <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;youtube-icon.svg&#34;</span> <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
  );
}
</code></pre></div><p>La derni√®re √©tape consistera √† renvoyer l‚Äôiframe Youtube si <code>showVideo</code> a une valeur √©gale √† <code>true</code>. Noter l&rsquo;ajout de <code>autoplay=1</code> apr√®s l&rsquo;URL de la vid√©o Youtube, c&rsquo;est ce param√®tre qui permet de d√©marrer la vid√©o sans n√©cessiter de second clic par l&rsquo;utilisateur :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">showVideo</span>) {
  <span style="color:#66d9ef">return</span> (
    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">iframe</span>
        <span style="color:#a6e22e">sandbox</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;allow-scripts allow-same-origin allow-presentation&#34;</span>
        <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`Vid√©o Youtube : </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">title</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>}
        <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`https://www.youtube.com/embed/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">?autoplay=1&amp;rel=0`</span>}
        <span style="color:#a6e22e">frameBorder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>
        <span style="color:#a6e22e">allow</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;autoplay; encrypted-media&#34;</span>
        <span style="color:#a6e22e">allowFullScreen</span>
        <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">style</span>}
      <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
  );
}
</code></pre></div><p>Et c‚Äôest aussi simple que cela, nous venons de cr√©er un composant n‚Äôaffichant (et t√©l√©chargeant) le lecteur Youtube uniquement si cela est n√©cessaire.</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-3/0_P_YZb65E6WVaBjbq.png" alt=""  />
</figure></p>
<p><em>J‚Äôaurai bien voulu convertir ce GIF en mp4 mais medium n‚Äôaccepte pas les vid√©os üòî</em> (Note: cet article est repris de medium üòâ)</p>
<p>Au final, voici le code de notre composant au complet :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">React</span>, { <span style="color:#a6e22e">useState</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;react&#34;</span>;
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;100%&#34;</span>,
  <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;350px&#34;</span>,
};
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">buttonStyle</span> <span style="color:#f92672">=</span> {
  ...<span style="color:#a6e22e">style</span>,
  <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;relative&#34;</span>,
  <span style="color:#a6e22e">overflow</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;hidden&#34;</span>,
  <span style="color:#a6e22e">cursor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;pointer&#34;</span>,
  <span style="color:#a6e22e">display</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;flex&#34;</span>,
  <span style="color:#a6e22e">justifyContent</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;center&#34;</span>,
  <span style="color:#a6e22e">alignItems</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;center&#34;</span>,
  <span style="color:#a6e22e">border</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;none&#34;</span>,
};
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imgStyle</span> <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;100%&#34;</span>,
  <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;100%&#34;</span>,
  <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;absolute&#34;</span>,
  <span style="color:#a6e22e">zIndex</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
};
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">youtubeIconStyle</span> <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">zIndex</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>,
};
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">YoutubeVideo</span>({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">title</span> }) {
  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">showVideo</span>, <span style="color:#a6e22e">setShowVideo</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#66d9ef">false</span>);
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">startVideo</span>() {
    <span style="color:#a6e22e">setShowVideo</span>(<span style="color:#66d9ef">true</span>);
  }
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">showVideo</span>) {
    <span style="color:#66d9ef">return</span> (
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">iframe</span>
          <span style="color:#a6e22e">sandbox</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;allow-scripts allow-same-origin allow-presentation&#34;</span>
          <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`Vid√©o Youtube : </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">title</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>}
          <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`https://www.youtube.com/embed/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">?autoplay=1&amp;rel=0`</span>}
          <span style="color:#a6e22e">frameBorder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>
          <span style="color:#a6e22e">allow</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;autoplay; encrypted-media&#34;</span>
          <span style="color:#a6e22e">allowFullScreen</span>
          <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">style</span>}
        <span style="color:#f92672">/&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
    );
  }
  <span style="color:#66d9ef">return</span> (
    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span>
      <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>
      <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`Vid√©o Youtube : </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">title</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>}
      <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">buttonStyle</span>}
      <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">startVideo</span>}
    <span style="color:#f92672">&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">img</span>
        <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">imgStyle</span>}
        <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`https://img.youtube.com/vi/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/hqdefault.jpg`</span>}
        <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
      <span style="color:#f92672">/&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">img</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">youtubeIconStyle</span>} <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;youtube-icon.svg&#34;</span> <span style="color:#a6e22e">alt</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
  );
}
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">YoutubeVideo</span>;
</code></pre></div><p>Cette optimisation peut sembler s‚Äôapparenter √† du bricolage mais le r√©sultat est bien l√† : une diminution de plus de 500 Ko du poids de votre page et un t√©l√©chargement uniquement si l‚Äôutilisateur souhaite consulter la vid√©o.</p>
<h2 id="-6---lighthouse">üßúüèª‚Äç‚ôÄÔ∏è 6 - Lighthouse</h2>
<p>Et s‚Äôil existait un outil testant l‚Äôensemble de ces crit√®res, voire plus ? Bonne nouvelle, cet outil existe et il se nomme Lighthouse !</p>
<p>Directement embarqu√© dans le navigateur Google Chrome ou disponible en ligne √† l‚Äôadresse <a href="https://developers.google.com/web/tools/lighthouse#psi" target="_blank">https://developers.google.com/web/tools/lighthouse#psi</a>, Lighthouse regroupe tout un panel de tests mesurant la vitesse - entre autres - de votre page.</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-3/0_oY07pBvN0Kaz5pYa.png" alt=""  />
</figure></p>
<p>L‚Äôoutil vous attribue ensuite un score sur 100 et des points d‚Äôam√©liorations.</p>
<p><figure>
  <img src="/articles/accelerer-vos-pages-web-quelques-reflexes-partie-3/0_V0973xjaN_zuI8om.png" alt=""  />
</figure></p>
<p>Auditer et surveiller ces m√©triques r√©guli√®rement (une fois par mois par exemple) est un r√©flexe important pour vous assurer que votre site continue d‚Äô√™tre performant au fur et √† mesure de son √©volution.</p>
<p>Je vous invite √† tester votre site d√®s maintenant et, si vous ne l‚Äôavez jamais fait, des surprises vous attendent s√ªrement üòâ !</p>
<hr>
<h2 id="-conclusion">üöÄ Conclusion</h2>
<p>Nous voici arriv√©s √† la fin de cette s√©rie d‚Äôarticles consacr√©e √† l‚Äôam√©lioration du chargement des pages Web. J‚Äôen profite pour vous remercier d‚Äôavoir pris le temps de la lire et j‚Äôesp√®re qu‚Äôelle vous aura plu üôÇ</p>
<p>Toutefois, ce billet n‚Äôa pas la pr√©tention d‚Äô√™tre exhaustif et d‚Äôautres optimisations aurait pu √™tre abord√©es comme http2, les CDN‚Ä¶ Je vous invite d‚Äôailleurs √† l‚Äôindiquer en commentaires üôÇ.</p>
<p>Je vous remercie d‚Äôavoir pris le temps de lire cette s√©rie et j‚Äôesp√®re que dor√©navant, vous contribuerez √† cr√©er un web plus l√©ger üòâ.</p>
<hr>
<h2 id="-aller-plus-loin">üî∞ Aller plus loin</h2>
<h3 id="vid√©os-et-articles">Vid√©os et articles</h3>
<p>Voici un ensemble de ressources pour explorer l‚Äôunivers de l‚Äôoptimisation des chargements :</p>
<ul>
<li>Fast load times : <a href="https://web.dev/fast/" target="_blank">https://web.dev/fast/</a></li>
<li>Lazy-loading d‚Äôimages et iframe : <a href="https://web.dev/native-lazy-loading/" target="_blank">https://web.dev/native-lazy-loading/</a></li>
<li>Code-splitting in React : <a href="https://reactjs.org/docs/code-splitting.html#route-based-code-splitting" target="_blank">https://reactjs.org/docs/code-splitting.html#route-based-code-splitting</a></li>
<li>Web performance made easy (Google I/O ‚Äô18) :
<a href="https://www.youtube.com/watch?v=Mv-l3-tJgGk" target="_blank">https://www.youtube.com/watch?v=Mv-l3-tJgGk</a></li>
<li>Speed at Scale: Web Performance Tips and Tricks from the Trenches (Google I/O ‚Äô19) : <a href="https://www.youtube.com/watch?v=YJGCZCaIZkQ" target="_blank">https://www.youtube.com/watch?v=YJGCZCaIZkQ</a></li>
</ul>
<h3 id="sur-twitter">Sur Twitter</h3>
<ul>
<li>Houssein Djirdeh : <a href="https://twitter.com/hdjirdeh" target="_blank">https://twitter.com/hdjirdeh</a></li>
<li>Addy Osmani : <a href="https://twitter.com/addyosmani" target="_blank">https://twitter.com/addyosmani</a></li>
<li>Katie Hempenius : <a href="https://twitter.com/katiehempenius" target="_blank">https://twitter.com/katiehempenius</a></li>
<li>Paul Irish : <a href="https://twitter.com/paul_irish" target="_blank">https://twitter.com/paul_irish</a></li>
<li>Lighthouse : <a href="https://twitter.com/____lighthouse" target="_blank">https://twitter.com/____lighthouse</a></li>
</ul>

</div>
</div>
</article>
</div>
</main><script src="/js/dark-mode.js"></script>

</body>
</html>
